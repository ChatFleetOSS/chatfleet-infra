:8080 {
  encode gzip zstd

  header {
    X-Content-Type-Options nosniff
    Referrer-Policy strict-origin-when-cross-origin
    Content-Security-Policy "default-src 'self'; img-src 'self' data: blob:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self'"
  }

  @api path /api*
  reverse_proxy @api api:8000 {
    header_up X-Forwarded-Proto {scheme}
    header_up X-Forwarded-For {remote}
    header_up X-Forwarded-Host {host}
  }

  reverse_proxy web:3000 {
    header_up X-Forwarded-Proto {scheme}
    header_up X-Forwarded-For {remote}
    header_up X-Forwarded-Host {host}
  }
}
